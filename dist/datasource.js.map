{"version":3,"sources":["datasource.js"],"names":["Object","defineProperty","exports","value","NGSIDatasource","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_lodash","require","_lodash2","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","TypeError","instanceSettings","$q","backendSrv","templateSrv","type","url","name","q","withCredentials","headers","basicAuth","query","options","queryResponse","data","promises","buildQueryParameters","targets","filter","t","hide","console","log","targetArray","split","myType","myTarget","myProperty","maxDataPoints","push","doRequest","range","from","to","method","Promise","all","then","results","returnArray","r","_returnObject","datapoints","contextElement","contextResponses","values","attributes","id","v","time","timeSplit","unixTime","datapointArray","recvTime","Date","getTime","attrValue","returnObject","testDatasource","response","status","message","title","annotationQuery","replace","annotation","datasource","enable","iconColor","rangeRaw","result","metricFindQuery","mode","pattern","queryURL","n","text","mapToTextValue","map","d","isObject","datasourceRequest","_this","scopedVars","refId"],"mappings":"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","file":"datasource.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.NGSIDatasource = undefined;\n\nvar _createClass = function () {\n    function defineProperties(target, props) {\n        for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);\n        }\n    }return function (Constructor, protoProps, staticProps) {\n        if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;\n    };\n}();\n\nvar _lodash = require('lodash');\n\nvar _lodash2 = _interopRequireDefault(_lodash);\n\nfunction _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n        throw new TypeError(\"Cannot call a class as a function\");\n    }\n}\n\nvar NGSIDatasource = exports.NGSIDatasource = function () {\n    function NGSIDatasource(instanceSettings, $q, backendSrv, templateSrv) {\n        _classCallCheck(this, NGSIDatasource);\n\n        this.type = instanceSettings.type;\n        this.url = instanceSettings.url;\n        this.name = instanceSettings.name;\n        this.q = $q;\n        this.backendSrv = backendSrv;\n        this.templateSrv = templateSrv;\n        this.withCredentials = instanceSettings.withCredentials;\n        this.headers = { 'Content-Type': 'application/json', \"fiware-servicepath\": \"/\" };\n        if (typeof instanceSettings.basicAuth === 'string' && instanceSettings.basicAuth.length > 0) {\n            this.headers['Authorization'] = instanceSettings.basicAuth;\n        }\n    }\n\n    _createClass(NGSIDatasource, [{\n        key: 'query',\n        value: function query(options) {\n            var queryResponse = {};\n            queryResponse.data = [];\n            var promises = [];\n            var query = this.buildQueryParameters(options);\n            query.targets = query.targets.filter(function (t) {\n                return !t.hide;\n            });\n\n            if (query.targets.length < 1) {\n                console.log(\"no data for this panel\");\n                return { data: [] };\n            }\n\n            for (var t in query.targets) {\n                // Timeserie response\n                var targetArray = query.targets[t].target.split(\".\");\n                var myType = targetArray[0];\n                var myTarget = targetArray[1];\n                var myProperty = targetArray[2];\n                var maxDataPoints = query.maxDataPoints;\n\n                /* Test settings\n                myType = \"testSensor\";\n                myTarget = \"00001C00000000000001000001000A00\";\n                myProperty = \"light\";\n                maxDataPoints = 5;*/\n\n                if (query.targets[t].target !== undefined && query.targets[t].target !== \"select entity\") {\n                    promises.push(this.doRequest({\n                        url: this.url + \"/v1/contextEntities/type/\" + myType + \"/id/\" + myTarget + \"/attributes/\" + myProperty + \"?lastN=\" + maxDataPoints + \"&dateFrom=\" + query.range.from + \"&dateTo=\" + query.range.to,\n                        method: 'GET'\n                    }));\n                } else {\n                    return { data: [] };\n                }\n            }\n            return Promise.all(promises).then(function (results) {\n                var returnArray = [];\n\n                for (var r in results) {\n                    var _returnObject = {};\n                    _returnObject.datapoints = [];\n\n                    var contextElement = results[r].data.contextResponses[0].contextElement;\n                    var values = contextElement.attributes[0].values;\n                    _returnObject.target = contextElement.attributes[0].name + \" (\" + contextElement.type + \": \" + contextElement.id + \")\";\n\n                    for (var v in values) {\n                        var time = void 0,\n                            timeSplit = void 0,\n                            unixTime = void 0;\n                        var datapointArray = [];\n                        time = values[v].recvTime;\n                        time += \"Z\";\n                        timeSplit = time.split(' ');\n                        time = timeSplit[0] + \"T\" + timeSplit[1];\n                        unixTime = new Date(time).getTime();\n                        datapointArray.push(values[v].attrValue);\n                        datapointArray.push(unixTime);\n                        _returnObject.datapoints.push(datapointArray);\n                    }\n                    returnArray.push(_returnObject);\n                }\n                var returnObject = {};\n                returnObject.data = returnArray;\n                return returnObject;\n            });\n        }\n    }, {\n        key: 'testDatasource',\n        value: function testDatasource() {\n            return this.doRequest({\n                url: this.url + \"/v2/entities\",\n                method: 'GET'\n            }).then(function (response) {\n                if (response.status === 200) {\n                    return { status: \"success\", message: \"Data source is working\", title: \"Success\" };\n                } else {\n                    return { status: \"success\", message: \"COMET URL cannot be automatically tested, sorry.\", title: \"No connection test possible\" };\n                }\n            });\n        }\n    }, {\n        key: 'annotationQuery',\n        value: function annotationQuery(options) {\n            var query = this.templateSrv.replace(options.annotation.query, {}, 'glob');\n            var annotationQuery = {\n                range: options.range,\n                annotation: {\n                    name: options.annotation.name,\n                    datasource: options.annotation.datasource,\n                    enable: options.annotation.enable,\n                    iconColor: options.annotation.iconColor,\n                    query: query\n                },\n                rangeRaw: options.rangeRaw\n            };\n\n            return this.doRequest({\n                url: this.url + '/annotations',\n                method: 'POST',\n                data: annotationQuery\n            }).then(function (result) {\n                return result.data;\n            });\n        }\n    }, {\n        key: 'metricFindQuery',\n        value: function metricFindQuery(mode, pattern) {\n            // Pre-fills data types\n            var queryURL = void 0;\n            if (mode === \"listTypes\") {\n                queryURL = \"/v2/types\";\n                return this.doRequest({\n                    url: this.url + queryURL,\n                    method: 'GET'\n                }).then(function (response) {\n                    if (response.status === 200) {\n                        var returnArray = [];\n                        for (var n = 0; n < response.data.length; n++) {\n                            if (response.data[n].type !== \"\" && response.data[n].type !== undefined) {\n                                var returnObject = {};\n                                returnObject.text = response.data[n].type;\n                                returnObject.value = response.data[n].type;\n                                returnArray.push(returnObject);\n                            }\n                        }\n                        return returnArray;\n                    }\n                });\n            } else if (mode === \"listIDs\" && pattern !== undefined && pattern !== \"select entity\") {\n                queryURL = \"/v2/entities?type=\" + pattern;\n                return this.doRequest({\n                    url: this.url + queryURL,\n                    method: 'GET'\n                }).then(function (response) {\n                    if (response.status === 200) {\n                        var returnArray = [];\n                        for (var n = 0; n < response.data.length; n++) {\n                            if (response.data[n].id !== \"\" && response.data[n].id !== undefined) {\n                                var returnObject = {};\n                                returnObject.text = response.data[n].id;\n                                returnObject.value = response.data[n].type + \".\" + response.data[n].id;\n                                returnArray.push(returnObject);\n                            }\n                        }\n                        return returnArray;\n                    }\n                });\n            }\n        }\n    }, {\n        key: 'mapToTextValue',\n        value: function mapToTextValue(result) {\n            return _lodash2.default.map(result.data, function (d, i) {\n                if (d && d.text && d.value) {\n                    return { text: d.text, value: d.value };\n                } else if (_lodash2.default.isObject(d)) {\n                    return { text: d, value: i };\n                }\n                return { text: d, value: d };\n            });\n        }\n    }, {\n        key: 'doRequest',\n        value: function doRequest(options) {\n            options.withCredentials = this.withCredentials;\n            options.headers = this.headers;\n\n            return this.backendSrv.datasourceRequest(options);\n        }\n    }, {\n        key: 'buildQueryParameters',\n        value: function buildQueryParameters(options) {\n            var _this = this;\n\n            //remove placeholder targets\n            options.targets = _lodash2.default.filter(options.targets, function (target) {\n                return target.target !== 'select entity';\n            });\n\n            var targets = _lodash2.default.map(options.targets, function (target) {\n                return {\n                    target: _this.templateSrv.replace(target.target, options.scopedVars, 'regex'),\n                    refId: target.refId,\n                    hide: target.hide,\n                    type: target.type || 'timeserie'\n                };\n            });\n\n            options.targets = targets;\n\n            return options;\n        }\n    }]);\n\n    return NGSIDatasource;\n}();\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map\n//# sourceMappingURL=datasource.js.map"]}