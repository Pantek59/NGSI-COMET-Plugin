{"version":3,"sources":["query_ctrl.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","Object","defineProperty","exports","value","DatasourceQueryCtrl","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","_sdk","require","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","setPrototypeOf","__proto__","_QueryCtrl","$scope","$injector","_this","getPrototypeOf","scope","targetType","type","getOptions","$query","_this2","res","datasource","metricFindQuery","returnArray","then","results","promises","r","targetArray","split","myType","myTarget","queryURL","push","doRequest","url","method","Promise","all","finals","f","keys","data","id","k","returnObject","text","catch","errors","console","log","getTypes","toggleEditorMode","rawQuery","onChangeInternal","panelCtrl","refresh","QueryCtrl","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.DatasourceQueryCtrl = undefined;\n\nvar _createClass = function () {\n    function defineProperties(target, props) {\n        for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if (\"value\" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);\n        }\n    }return function (Constructor, protoProps, staticProps) {\n        if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;\n    };\n}();\n\nvar _sdk = require('app/plugins/sdk');\n\nrequire('./css/query-editor.css!');\n\nfunction _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n        throw new TypeError(\"Cannot call a class as a function\");\n    }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n    if (!self) {\n        throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }return call && ((typeof call === \"undefined\" ? \"undefined\" : _typeof(call)) === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n        throw new TypeError(\"Super expression must either be null or a function, not \" + (typeof superClass === \"undefined\" ? \"undefined\" : _typeof(superClass)));\n    }subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar DatasourceQueryCtrl = exports.DatasourceQueryCtrl = function (_QueryCtrl) {\n    _inherits(DatasourceQueryCtrl, _QueryCtrl);\n\n    function DatasourceQueryCtrl($scope, $injector) {\n        _classCallCheck(this, DatasourceQueryCtrl);\n\n        var _this = _possibleConstructorReturn(this, (DatasourceQueryCtrl.__proto__ || Object.getPrototypeOf(DatasourceQueryCtrl)).call(this, $scope, $injector));\n\n        _this.scope = $scope;\n        _this.target.targetType = _this.target.targetType || 'select type';\n        _this.target.target = _this.target.target || 'select entity';\n        _this.target.type = _this.target.type || 'timeserie';\n        return _this;\n    }\n\n    _createClass(DatasourceQueryCtrl, [{\n        key: 'getOptions',\n        value: function getOptions($query) {\n            var _this2 = this;\n\n            if (this.target.targetType !== undefined && this.target.targetType !== \"select type\") {\n                var res = this.datasource.metricFindQuery(\"listIDs\", this.target.targetType);\n                if (this.target.type === \"table\") {\n                    return res;\n                } else if (this.target.type === \"timeserie\") {\n                    var returnArray = [];\n                    return res.then(function (results) {\n                        var promises = [];\n                        for (var r in results) {\n                            var targetArray = results[r].value.split(\".\");\n                            var myType = targetArray[0];\n                            var myTarget = targetArray[1];\n\n                            var queryURL = \"/v2/entities/\" + myTarget + \"?type=\" + myType + \"&options=keyValues\";\n                            promises.push(_this2.datasource.doRequest({\n                                url: _this2.datasource.url + queryURL,\n                                method: 'GET'\n                            }));\n                        }\n\n                        return Promise.all(promises).then(function (finals) {\n\n                            for (var f in finals) {\n                                var keys = Object.keys(finals[f].data);\n                                var id = finals[f].data.id;\n                                var type = finals[f].data.type;\n                                for (var k in keys) {\n                                    if (keys[k] !== \"id\" && keys[k] !== \"type\") {\n                                        var returnObject = {};\n                                        returnObject.text = id + \" (\" + keys[k] + \")\";\n                                        returnObject.value = type + \".\" + id + \".\" + keys[k];\n                                        returnArray.push(returnObject);\n                                    }\n                                }\n                            }\n                            return returnArray;\n                        }).catch(function (errors) {\n                            console.log(errors);\n                        });\n                    });\n                }\n            } else {\n                console.log(\"Entity Type undefined!\");\n                return null;\n            }\n        }\n    }, {\n        key: 'getTypes',\n        value: function getTypes() {\n            return this.datasource.metricFindQuery(\"listTypes\");\n        }\n    }, {\n        key: 'toggleEditorMode',\n        value: function toggleEditorMode() {\n            this.target.rawQuery = !this.target.rawQuery;\n        }\n    }, {\n        key: 'onChangeInternal',\n        value: function onChangeInternal() {\n            this.panelCtrl.refresh(); // Asks the panel to refresh data.\n        }\n    }]);\n\n    return DatasourceQueryCtrl;\n}(_sdk.QueryCtrl);\n\nDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n//# sourceMappingURL=query_ctrl.js.map\n//# sourceMappingURL=query_ctrl.js.map"]}